
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Original Analysis &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Compas Analysis';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Extension - Natural Language Processing" href="chapter-six.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    How We Recreated the Analysis of the COMPAS Recidivism Algorithm
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter-one.html">Descriptive Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-two.html">Predictive Accuracy of COMPAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-three.html">Directions of the Racial Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-four.html">Risk of Violent Recidivism</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-five.html">Extension - Investigating Prior Charges</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-six.html">Extension - Natural Language Processing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Original Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/lisds/dsip-project-template/main?urlpath=lab/tree/Compas Analysis.Rmd" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://ds.lis.2i2c.cloud/hub/user-redirect/git-pull?repo=https%3A//github.com/lisds/dsip-project-template&urlpath=lab/tree/dsip-project-template/Compas+Analysis.Rmd&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/lisds/dsip-project-template" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/lisds/dsip-project-template/issues/new?title=Issue%20on%20page%20%2FCompas Analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Compas Analysis.Rmd" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.Rmd</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Original Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#racial-bias-in-compas">Racial Bias in Compas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-of-violent-recidivism">Risk of Violent Recidivism</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-accuracy-of-compas">Predictive Accuracy of COMPAS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directions-of-the-racial-bias">Directions of the Racial Bias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Risk of Violent Recidivism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gender-differences-in-compas-scores">Gender differences in Compas scores</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="original-analysis">
<h1>Original Analysis<a class="headerlink" href="#original-analysis" title="Link to this heading">#</a></h1>
<p>What follows are the calculations performed for ProPublica’s analaysis of the COMPAS Recidivism Risk Scores. It might be helpful to open <a class="reference external" href="https://www.propublica.org/article/how-we-analyzed-the-compas-recidivism-algorithm/">the methodology</a> in another tab to understand the following.</p>
<section id="loading-the-data">
<h2>Loading the Data<a class="headerlink" href="#loading-the-data" title="Link to this heading">#</a></h2>
<p>We select fields for severity of charge, number of priors, demographics, age, sex, compas scores, and whether each person was accused of a crime within two years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
library(dplyr)
library(ggplot2)
raw_data &lt;- read.csv(&quot;./compas-scores-two-years.csv&quot;)
nrow(raw_data)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UsageError: Cell magic `%%R` not found.
</pre></div>
</div>
</div>
</div>
<p>However not all of the rows are useable for the first round of analysis.</p>
<p>There are a number of reasons remove rows because of missing data:</p>
<ul class="simple">
<li><p>If the charge date of a defendants Compas scored crime was not within 30 days from when the person was arrested, we assume that because of data quality reasons, that we do not have the right offense.</p></li>
<li><p>We coded the recidivist flag – <code class="docutils literal notranslate"><span class="pre">is_recid</span></code> – to be -1 if we could not find a compas case at all.</p></li>
<li><p>In a similar vein, ordinary traffic offenses – those with a <code class="docutils literal notranslate"><span class="pre">c_charge_degree</span></code> of ‘O’ – will not result in Jail time are removed (only two of them).</p></li>
<li><p>We filtered the underlying data from Broward county to include only those rows representing people who had either recidivated in two years, or had at least two years outside of a correctional facility.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
df &lt;- dplyr::select(raw_data, age, c_charge_degree, race, age_cat, score_text, sex, priors_count, 
                    days_b_screening_arrest, decile_score, is_recid, two_year_recid, c_jail_in, c_jail_out) %&gt;% 
        filter(days_b_screening_arrest &lt;= 30) %&gt;%
        filter(days_b_screening_arrest &gt;= -30) %&gt;%
        filter(is_recid != -1) %&gt;%
        filter(c_charge_degree != &quot;O&quot;) %&gt;%
        filter(score_text != &#39;N/A&#39;)
nrow(df)
</pre></div>
</div>
</div>
</div>
<p>Higher COMPAS scores are slightly correlated with a longer length of stay.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
df$length_of_stay &lt;- as.numeric(as.Date(df$c_jail_out) - as.Date(df$c_jail_in))
cor(df$length_of_stay, df$decile_score)
</pre></div>
</div>
</div>
</div>
<p>After filtering we have the following demographic breakdown:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$age_cat)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$race)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Black defendants: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>            <span class="p">(</span><span class="mi">3175</span> <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White defendants: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>            <span class="p">(</span><span class="mi">2103</span> <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hispanic defendants: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>         <span class="p">(</span><span class="mi">509</span>  <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asian defendants: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>            <span class="p">(</span><span class="mi">31</span>   <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Native American defendants: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="mi">11</span>   <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$score_text)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
xtabs(~ sex + race, data=df)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$sex)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Men: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span>   <span class="p">(</span><span class="mi">4997</span> <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Women: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1175</span> <span class="o">/</span> <span class="mi">6172</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
nrow(filter(df, two_year_recid == 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
nrow(filter(df, two_year_recid == 1)) / nrow(df) * 100
</pre></div>
</div>
</div>
</div>
<p>Judges are often presented with two sets of scores from the Compas system – one that classifies people into High, Medium and Low risk, and a corresponding decile score. There is a clear downward trend in the decile scores as those scores increase for white defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 363 -u px
library(grid)
library(gridExtra)
pblack &lt;- ggplot(data=filter(df, race ==&quot;African-American&quot;), aes(ordered(decile_score))) + 
          geom_bar() + xlab(&quot;Decile Score&quot;) +
          ylim(0, 650) + ggtitle(&quot;Black Defendant&#39;s Decile Scores&quot;)
pwhite &lt;- ggplot(data=filter(df, race ==&quot;Caucasian&quot;), aes(ordered(decile_score))) + 
          geom_bar() + xlab(&quot;Decile Score&quot;) +
          ylim(0, 650) + ggtitle(&quot;White Defendant&#39;s Decile Scores&quot;)
grid.arrange(pblack, pwhite,  ncol = 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
xtabs(~ decile_score + race, data=df)
</pre></div>
</div>
</div>
</div>
</section>
<section id="racial-bias-in-compas">
<h2>Racial Bias in Compas<a class="headerlink" href="#racial-bias-in-compas" title="Link to this heading">#</a></h2>
<p>After filtering out bad rows, our first question is whether there is a significant difference in Compas scores between races. To do so we need to change some variables into factors, and run a logistic regression, comparing low scores to high scores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
df &lt;- mutate(df, crime_factor = factor(c_charge_degree)) %&gt;%
      mutate(age_factor = as.factor(age_cat)) %&gt;%
      within(age_factor &lt;- relevel(age_factor, ref = 1)) %&gt;%
      mutate(race_factor = factor(race)) %&gt;%
      within(race_factor &lt;- relevel(race_factor, ref = 3)) %&gt;%
      mutate(gender_factor = factor(sex, labels= c(&quot;Female&quot;,&quot;Male&quot;))) %&gt;%
      within(gender_factor &lt;- relevel(gender_factor, ref = 2)) %&gt;%
      mutate(score_factor = factor(score_text != &quot;Low&quot;, labels = c(&quot;LowScore&quot;,&quot;HighScore&quot;)))
model &lt;- glm(score_factor ~ gender_factor + age_factor + race_factor +
                            priors_count + crime_factor + two_year_recid, family=&quot;binomial&quot;, data=df)
summary(model)
</pre></div>
</div>
</div>
</div>
<p>Black defendants are 45% more likely than white defendants to receive a higher score correcting for the seriousness of their crime, previous arrests, and future criminal behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
control &lt;- exp(-1.52554) / (1 + exp(-1.52554))
exp(0.47721) / (1 - control + (control * exp(0.47721)))
</pre></div>
</div>
</div>
</div>
<p>Women are 19.4% more likely than men to get a higher score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
exp(0.22127) / (1 - control + (control * exp(0.22127)))
</pre></div>
</div>
</div>
</div>
<p>Most surprisingly, people under 25 are 2.5 times as likely to get a higher score as middle aged defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
exp(1.30839) / (1 - control + (control * exp(1.30839)))
</pre></div>
</div>
</div>
</div>
<section id="risk-of-violent-recidivism">
<h3>Risk of Violent Recidivism<a class="headerlink" href="#risk-of-violent-recidivism" title="Link to this heading">#</a></h3>
<p>Compas also offers a score that aims to measure a persons risk of violent recidivism, which has a similar overall accuracy to the Recidivism score. As before, we can use a logistic regression to test for racial bias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
raw_data &lt;- read.csv(&quot;./compas-scores-two-years-violent.csv&quot;)
nrow(raw_data)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
df &lt;- dplyr::select(raw_data, age, c_charge_degree, race, age_cat, v_score_text, sex, priors_count, 
                    days_b_screening_arrest, v_decile_score, is_recid, two_year_recid) %&gt;% 
        filter(days_b_screening_arrest &lt;= 30) %&gt;%
        filter(days_b_screening_arrest &gt;= -30) %&gt;% 
        filter(is_recid != -1) %&gt;%
        filter(c_charge_degree != &quot;O&quot;) %&gt;%
        filter(v_score_text != &#39;N/A&#39;)
nrow(df)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$age_cat)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$race)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(df$v_score_text)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
nrow(filter(df, two_year_recid == 1)) / nrow(df) * 100
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
nrow(filter(df, two_year_recid == 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 363 -u px
library(grid)
library(gridExtra)
pblack &lt;- ggplot(data=filter(df, race ==&quot;African-American&quot;), aes(ordered(v_decile_score))) + 
          geom_bar() + xlab(&quot;Violent Decile Score&quot;) +
          ylim(0, 700) + ggtitle(&quot;Black Defendant&#39;s Violent Decile Scores&quot;)
pwhite &lt;- ggplot(data=filter(df, race ==&quot;Caucasian&quot;), aes(ordered(v_decile_score))) + 
          geom_bar() + xlab(&quot;Violent Decile Score&quot;) +
          ylim(0, 700) + ggtitle(&quot;White Defendant&#39;s Violent Decile Scores&quot;)
grid.arrange(pblack, pwhite,  ncol = 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
df &lt;- mutate(df, crime_factor = factor(c_charge_degree)) %&gt;%
      mutate(age_factor = as.factor(age_cat)) %&gt;%
      within(age_factor &lt;- relevel(age_factor, ref = 1)) %&gt;%
      mutate(race_factor = factor(race,
                                  labels = c(&quot;African-American&quot;, 
                                             &quot;Asian&quot;,
                                             &quot;Caucasian&quot;, 
                                             &quot;Hispanic&quot;, 
                                             &quot;Native American&quot;,
                                             &quot;Other&quot;))) %&gt;%
      within(race_factor &lt;- relevel(race_factor, ref = 3)) %&gt;%
      mutate(gender_factor = factor(sex, labels= c(&quot;Female&quot;,&quot;Male&quot;))) %&gt;%
      within(gender_factor &lt;- relevel(gender_factor, ref = 2)) %&gt;%
      mutate(score_factor = factor(v_score_text != &quot;Low&quot;, labels = c(&quot;LowScore&quot;,&quot;HighScore&quot;)))
model &lt;- glm(score_factor ~ gender_factor + age_factor + race_factor +
                            priors_count + crime_factor + two_year_recid, family=&quot;binomial&quot;, data=df)
summary(model)
</pre></div>
</div>
</div>
</div>
<p>The violent score overpredicts recidivism for black defendants by 77.3% compared to white defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
control &lt;- exp(-2.24274) / (1 + exp(-2.24274))
exp(0.65893) / (1 - control + (control * exp(0.65893)))
</pre></div>
</div>
</div>
</div>
<p>Defendands under 25 are 7.4 times as likely to get a higher score as middle aged defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
exp(3.14591) / (1 - control + (control * exp(3.14591)))
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="predictive-accuracy-of-compas">
<h2>Predictive Accuracy of COMPAS<a class="headerlink" href="#predictive-accuracy-of-compas" title="Link to this heading">#</a></h2>
<p>In order to test whether Compas scores do an accurate job of deciding whether an offender is Low, Medium or High risk,  we ran a Cox Proportional Hazards model. Northpointe, the company that created COMPAS and markets it to Law Enforcement, also ran a Cox model in their <a class="reference external" href="http://cjb.sagepub.com/content/36/1/21.abstract">validation study</a>.</p>
<p>We used the counting model and removed people when they were incarcerated. Due to errors in the underlying jail data, we need to filter out 32 rows that have an end date more than the start date. Considering that there are 13,334 total rows in the data, such a small amount of errors will not affect the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
library(survival)
library(ggfortify)

data &lt;- filter(filter(read.csv(&quot;./cox-parsed.csv&quot;), score_text != &quot;N/A&quot;), end &gt; start) %&gt;%
        mutate(race_factor = factor(race,
                                  labels = c(&quot;African-American&quot;, 
                                             &quot;Asian&quot;,
                                             &quot;Caucasian&quot;, 
                                             &quot;Hispanic&quot;, 
                                             &quot;Native American&quot;,
                                             &quot;Other&quot;))) %&gt;%
        within(race_factor &lt;- relevel(race_factor, ref = 3)) %&gt;%
        mutate(score_factor = factor(score_text)) %&gt;%
        within(score_factor &lt;- relevel(score_factor, ref=2))

grp &lt;- data[!duplicated(data$id),]
nrow(grp)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(grp$score_factor)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(grp$race_factor)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
f &lt;- Surv(start, end, event, type=&quot;counting&quot;) ~ score_factor
model &lt;- coxph(f, data=data)
summary(model)
</pre></div>
</div>
</div>
</div>
<p>People placed in the High category are 3.5 times as likely to recidivate, and the COMPAS system’s concordance 63.6%. This is lower than the accuracy quoted in the Northpoint study of 68%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
decile_f &lt;- Surv(start, end, event, type=&quot;counting&quot;) ~ decile_score
dmodel &lt;- coxph(decile_f, data=data)
summary(dmodel)
</pre></div>
</div>
</div>
</div>
<p>COMPAS’s decile scores are a bit more accurate at 66%.</p>
<p>We can test if the algorithm is behaving differently across races by including a race interaction term in the cox model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
f2 &lt;- Surv(start, end, event, type=&quot;counting&quot;) ~ race_factor + score_factor + race_factor * score_factor
model &lt;- coxph(f2, data=data)
print(summary(model))
</pre></div>
</div>
</div>
</div>
<p>The interaction term shows a similar disparity as the logistic regression above.</p>
<p>High risk white defendants are 3.61 more likely than low risk white defendants, while High risk black defendants are 2.99 more likely than low.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Black High Hazard: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.18976</span> <span class="o">+</span> <span class="mf">1.28350</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White High Hazard: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.28350</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Black Medium Hazard: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.84286</span><span class="o">-</span><span class="mf">0.17261</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White Medium Hazard: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.84286</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 563 -u px

fit &lt;- survfit(f, data=data)

plotty &lt;- function(fit, title) {
  return(autoplot(fit, conf.int=T, censor=F) + ggtitle(title) + ylim(0,1))
}
plotty(fit, &quot;Overall&quot;)
</pre></div>
</div>
</div>
</div>
<p>Black defendants do recidivate at higher rates according to race specific Kaplan Meier plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 363 -u px
white &lt;- filter(data, race == &quot;Caucasian&quot;)
white_fit &lt;- survfit(f, data=white)

black &lt;- filter(data, race == &quot;African-American&quot;)
black_fit &lt;- survfit(f, data=black)

grid.arrange(plotty(white_fit, &quot;White defendants&quot;), 
             plotty(black_fit, &quot;Black defendants&quot;), ncol=2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(fit, times=c(730))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(black_fit, times=c(730))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(white_fit, times=c(730))
</pre></div>
</div>
</div>
</div>
<p>Race specific models have similar concordance values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(coxph(f, data=white))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(coxph(f, data=black))
</pre></div>
</div>
</div>
</div>
<p>Compas’s violent recidivism score has a slightly higher overall concordance score of 65.1%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
violent_data &lt;- filter(filter(read.csv(&quot;./cox-violent-parsed.csv&quot;), score_text != &quot;N/A&quot;), end &gt; start) %&gt;%
        mutate(race_factor = factor(race,
                                  labels = c(&quot;African-American&quot;, 
                                             &quot;Asian&quot;,
                                             &quot;Caucasian&quot;, 
                                             &quot;Hispanic&quot;, 
                                             &quot;Native American&quot;,
                                             &quot;Other&quot;))) %&gt;%
        within(race_factor &lt;- relevel(race_factor, ref = 3)) %&gt;%
        mutate(score_factor = factor(score_text)) %&gt;%
        within(score_factor &lt;- relevel(score_factor, ref=2))


vf &lt;- Surv(start, end, event, type=&quot;counting&quot;) ~ score_factor
vmodel &lt;- coxph(vf, data=violent_data)
vgrp &lt;- violent_data[!duplicated(violent_data$id),]
print(nrow(vgrp))
summary(vmodel)
</pre></div>
</div>
</div>
</div>
<p>In this case, there isn’t a significant coefficient on African American’s with High Scores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
vf2 &lt;- Surv(start, end, event, type=&quot;counting&quot;) ~ race_factor + race_factor * score_factor
vmodel &lt;- coxph(vf2, data=violent_data)
summary(vmodel)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(coxph(vf, data=filter(violent_data, race == &quot;African-American&quot;)))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(coxph(vf, data=filter(violent_data, race == &quot;Caucasian&quot;)))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 363 -u px
white &lt;- filter(violent_data, race == &quot;Caucasian&quot;)
white_fit &lt;- survfit(vf, data=white)

black &lt;- filter(violent_data, race == &quot;African-American&quot;)
black_fit &lt;- survfit(vf, data=black)

grid.arrange(plotty(white_fit, &quot;White defendants&quot;), 
             plotty(black_fit, &quot;Black defendants&quot;), ncol=2)
</pre></div>
</div>
</div>
</div>
</section>
<section id="directions-of-the-racial-bias">
<h2>Directions of the Racial Bias<a class="headerlink" href="#directions-of-the-racial-bias" title="Link to this heading">#</a></h2>
<p>The above analysis shows that the Compas algorithm does overpredict African-American defendant’s future recidivism, but we haven’t yet explored the direction of the bias. We can discover fine differences in overprediction and underprediction by comparing Compas scores across racial lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">truth_tables</span> <span class="kn">import</span> <span class="n">PeekyReader</span><span class="p">,</span> <span class="n">Person</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">is_race</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">vtable</span><span class="p">,</span> <span class="n">hightable</span><span class="p">,</span> <span class="n">vhightable</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">DictReader</span>

<span class="n">people</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./cox-parsed.csv&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">PeekyReader</span><span class="p">(</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">pop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">recidivist</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&lt;=</span> <span class="mi">730</span><span class="p">)</span> <span class="ow">or</span>
                              <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&gt;</span> <span class="mi">730</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">score_valid</span><span class="p">,</span> <span class="n">people</span><span class="p">))))</span>
<span class="n">recid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">recidivist</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&lt;=</span> <span class="mi">730</span><span class="p">,</span> <span class="n">pop</span><span class="p">))</span>
<span class="n">rset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">recid</span><span class="p">)</span>
<span class="n">surv</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pop</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rset</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All defendants&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">recid</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">surv</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total pop: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2681</span> <span class="o">+</span> <span class="mi">1282</span> <span class="o">+</span> <span class="mi">1216</span> <span class="o">+</span> <span class="mi">2035</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average followup time </span><span class="si">%.2f</span><span class="s2"> (sd </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">pop</span><span class="p">)),</span>
                                                <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">pop</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median followup time </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">pop</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</div>
<p>Overall, the false positive rate is 32.35%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Black defendants&quot;</span><span class="p">)</span>
<span class="n">is_afam</span> <span class="o">=</span> <span class="n">is_race</span><span class="p">(</span><span class="s2">&quot;African-American&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">recid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">surv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>That number is higher for African Americans at 44.85%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White defendants&quot;</span><span class="p">)</span>
<span class="n">is_white</span> <span class="o">=</span> <span class="n">is_race</span><span class="p">(</span><span class="s2">&quot;Caucasian&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">recid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">surv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>And lower for whites at 23.45%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">44.85</span> <span class="o">/</span> <span class="mf">23.45</span>
</pre></div>
</div>
</div>
</div>
<p>Which means under COMPAS black defendants are 91% more likely to get a higher score and not go on to commit more crimes than white defendants after two year.</p>
<p>COMPAS scores misclassify white reoffenders as low risk at 70.4% more often than black reoffenders.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">47.72</span> <span class="o">/</span> <span class="mf">27.99</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hightable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">recid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">surv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hightable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">recid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">surv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>Risk of Violent Recidivism<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Compas also offers a score that aims to measure a persons risk of violent recidivism, which has a similar overall accuracy to the Recidivism score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vpeople</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./cox-violent-parsed.csv&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">PeekyReader</span><span class="p">(</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="n">vpeople</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">vpop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">violent_recidivist</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&lt;=</span> <span class="mi">730</span><span class="p">)</span> <span class="ow">or</span>
                              <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&gt;</span> <span class="mi">730</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">vscore_valid</span><span class="p">,</span> <span class="n">vpeople</span><span class="p">))))</span>
<span class="n">vrecid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">violent_recidivist</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">&lt;=</span> <span class="mi">730</span><span class="p">,</span> <span class="n">vpeople</span><span class="p">))</span>
<span class="n">vrset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vrecid</span><span class="p">)</span>
<span class="n">vsurv</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vpop</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vrset</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All defendants&quot;</span><span class="p">)</span>
<span class="n">vtable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">vrecid</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">vsurv</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Even moreso for Black defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Black defendants&quot;</span><span class="p">)</span>
<span class="n">is_afam</span> <span class="o">=</span> <span class="n">is_race</span><span class="p">(</span><span class="s2">&quot;African-American&quot;</span><span class="p">)</span>
<span class="n">vtable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">vrecid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_afam</span><span class="p">,</span> <span class="n">vsurv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White defendants&quot;</span><span class="p">)</span>
<span class="n">is_white</span> <span class="o">=</span> <span class="n">is_race</span><span class="p">(</span><span class="s2">&quot;Caucasian&quot;</span><span class="p">)</span>
<span class="n">vtable</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">vrecid</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">is_white</span><span class="p">,</span> <span class="n">vsurv</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Black defendants are twice as likely to be false positives for a Higher violent score than white defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">38.14</span> <span class="o">/</span> <span class="mf">18.46</span>
</pre></div>
</div>
</div>
</div>
<p>White defendants are 63% more likely to get a lower score and commit another crime than Black defendants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">62.62</span> <span class="o">/</span> <span class="mf">38.37</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="gender-differences-in-compas-scores">
<h2>Gender differences in Compas scores<a class="headerlink" href="#gender-differences-in-compas-scores" title="Link to this heading">#</a></h2>
<p>In terms of underlying recidivism rates, we can look at gender specific Kaplan Meier estimates. There is a striking difference between women and men.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>

female &lt;- filter(data, sex == &quot;Female&quot;)
male   &lt;- filter(data, sex == &quot;Male&quot;)
male_fit &lt;- survfit(f, data=male)
female_fit &lt;- survfit(f, data=female)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(male_fit, times=c(730))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span>
summary(female_fit, times=c(730))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">R</span> -w 900 -h 363 -u px
grid.arrange(plotty(female_fit, &quot;Female&quot;), plotty(male_fit, &quot;Male&quot;),ncol=2)
</pre></div>
</div>
</div>
</div>
<p>As these plots show, the Compas score treats a High risk women the same as a Medium risk man.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "lisds/dsip-project-template",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter-six.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Extension - Natural Language Processing</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#racial-bias-in-compas">Racial Bias in Compas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-of-violent-recidivism">Risk of Violent Recidivism</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-accuracy-of-compas">Predictive Accuracy of COMPAS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directions-of-the-racial-bias">Directions of the Racial Bias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Risk of Violent Recidivism</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gender-differences-in-compas-scores">Gender differences in Compas scores</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>